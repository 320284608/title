<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>佳曦地瓜🍠熟能生生巧🤜英语大作战✍️</title>
    <style>
        :root {
            --primary-color: #673AB7;
            --secondary-color: #4CAF50;
            --error-color: #FF5722;
            --day-bg-color: #f5f5f5;
            --day-header-bg: white;
            --day-text-color: #333;
            --night-bg-color: #121212;
            --night-header-bg: #222;
            --night-text-color: #ddd;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--day-bg-color);
            color: var(--day-text-color);
            transition: background-color 0.3s, color 0.3s;
        }

        /* 顶部菜单栏 */
        .header {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: var(--day-header-bg);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s;
        }

        .menu {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
        }

        .menu-item {
            color: #666;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .menu-item.active {
            background: var(--primary-color);
            color: white;
        }

        /* 新增导入题库输入框样式 */
        .import-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-left: 10px;
        }

        /* 夜间模式按钮 */
        .night-mode-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* 主内容区 */
        .main-content {
            max-width: 800px;
            margin: 30px auto;
            padding: 20px;
        }

        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 70%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
        }

        .progress-fill {
            width: 4%;
            height: 100%;
            background: var(--secondary-color);
            border-radius: 4px;
            transition: width 0.3s;
        }

        .timer {
            color: var(--primary-color);
            font-family: monospace;
        }

        /* 题目区域 */
        .question-box {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin: 25px 0;
            transition: background-color 0.3s;
        }

        .chinese-word {
            font-size: 2.5em;
            margin: 20px 0;
            color: var(--primary-color);
        }

        .underline {
            width: 60px;
            height: 3px;
            background: var(--primary-color);
            margin: 0 auto;
        }

        .answer-input {
            width: 80%;
            padding: 12px 20px;
            margin: 25px 0;
            border: 2px solid #ddd;
            border-radius: 30px;
            font-size: 1.1em;
            transition: border-color 0.3s;
        }

        .answer-input.error {
            border-color: var(--error-color);
        }

        /* 功能按钮 */
        .action-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            padding: 14px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .submit-btn {
            background: var(--primary-color);
            color: white;
        }

        .audio-btn {
            background: #2196F3;
            color: white;
        }

        .show-answer-btn {
            background: #FF5722;
            color: white;
        }

        .explanation-btn {
            background: #009688;
            color: white;
        }

        /* 底部导航 */
        .footer-nav {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }

        .nav-btn {
            padding: 12px 25px;
            background: white;
            border: 2px solid var(--primary-color);
            border-radius: 30px;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        /* 统计面板 */
        .stats-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            display: none;
            transition: background-color 0.3s, color 0.3s;
        }

        /* 答案弹出框美化 */
        .answer-popup {
            position: fixed;
            top: 20%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: none;
            width: 300px;
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }

        .answer-popup-content {
            padding: 10px;
            font-size: 1.5em;
            color: var(--primary-color);
        }

        .answer-popup button {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            background: var(--primary-color);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        /* 新增考试人姓名输入样式 */
        .name-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-left: 10px;
        }

        /* 错误字母样式 */
        .wrong-letter {
            color: var(--error-color);
        }

        @media(max-width: 768px) {
            /* 手机屏幕适配 */
            .main-content {
                padding: 10px;
            }
            .question-box {
                padding: 20px;
            }
            .chinese-word {
                font-size: 2em;
            }
            .answer-input {
                width: 100%;
            }
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }

        @media(min-width: 768px) {
            .answer-popup {
                left: auto;
                right: 10px;
                top: 10px;
                transform: none;
            }
        }

        /* 夜间模式样式 */
        body.night-mode {
            background: var(--night-bg-color);
            color: var(--night-text-color);
        }

        body.night-mode .header {
            background: var(--night-header-bg);
        }

        body.night-mode .question-box {
            background: var(--night-header-bg);
        }

        body.night-mode .nav-btn {
            background: var(--night-header-bg);
            color: var(--night-text-color);
        }

        body.night-mode .stats-panel {
            background: var(--night-header-bg);
        }

        body.night-mode .answer-popup {
            background: var(--night-header-bg);
        }
    </style>
</head>

<body>
    <!-- 顶部菜单 -->
    <div class="header">
        <div class="menu">
            <select id="unit-select" class="menu-item">
                <option value="1">三年级上册第1单元</option>
                <option value="2">三年级上册第2单元</option>
                <option value="3">三年级上册第3单元</option>
                <option value="4">四年级上册第1单元</option>
                <option value="5">四年级上册第2单元</option>
                <option value="6">四年级上册第3单元</option>
                <option value="7">五年级上册第1单元</option>
                <option value="8">五年级上册第2单元</option>
                <option value="9">五年级上册第3单元</option>
                <option value="10">六年级上册第1单元</option>
                <option value="11">六年级上册第2单元</option>
                <option value="12">小学必背单词</option>
            </select>
            <label for="name-input">考试人姓名:</label>
            <input type="text" id="name-input" class="name-input" placeholder="请输入姓名">
            <label for="import-url">导入题库URL:</label>
            <input type="text" id="import-url" class="import-input" placeholder="请输入题库URL">
            <button onclick="importQuestions()">导入</button>
            <button class="night-mode-btn" onclick="toggleNightMode()">夜间模式</button>
        </div>
    </div>

    <!-- 主内容区 -->
    <div class="main-content">
        <div class="progress-container">
            <div class="timer">00:00:00</div>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <div id="question-count">1/15</div>
        </div>

        <div class="question-box">
            <div class="chinese-word" id="chinese-word">你</div>
            <div class="underline"></div>
            <input type="text" class="answer-input" id="answer-input" placeholder="输入英文翻译">
            <div id="answer-display"></div>

            <div class="action-buttons">
                <button class="action-btn submit-btn">提交</button>
                <button class="action-btn audio-btn">播放发音</button>
                <button class="action-btn show-answer-btn">显示答案</button>
                <button class="action-btn explanation-btn">显示解释</button>
            </div>
        </div>

        <!-- 导航按钮 -->
        <div class="footer-nav">
            <button class="nav-btn prev-btn">上一题</button>
            <button class="nav-btn next-btn">下一题</button>
        </div>
    </div>

    <!-- 答案弹出框 -->
    <div class="answer-popup" id="answer-popup">
        <div class="answer-popup-content" id="answer-popup-content"></div>
        <button onclick="document.getElementById('answer-popup').style.display='none'">关闭</button>
    </div>

    <!-- 统计面板 -->
    <div class="stats-panel">
        <h3>学习统计</h3>
        <p>考试人姓名: <span id="examiner-name">无</span></p>
        <p>单元名称: <span id="unit-name">无</span></p>
        <p>正确率: <span id="accuracy">0%</span></p>
        <p>耗时: <span id="total-time">0分钟</span></p>
        <p>得分: <span id="total-score">0</span></p>
        <label for="send-to-wechat">是否发送到微信机器人:</label>
        <input type="checkbox" id="send-to-wechat">
        <button onclick="handleStatsClose()">关闭</button>
    </div>

    <!-- 导入单元内容 -->
    <script src="unit1_3rd_upper.js"></script>
    <script src="unit2_3rd_upper.js"></script>
    <script src="unit3_3rd_upper.js"></script>
    <script src="unit1_4th_upper.js"></script>
    <script src="unit2_4th_upper.js"></script>
    <script src="unit3_4th_upper.js"></script>
    <script src="unit1_5th_upper.js"></script>
    <script src="unit2_5th_upper.js"></script>
    <script src="unit3_5th_upper.js"></script>
    <script src="unit1_6th_upper.js"></script>
    <script src="unit2_6th_upper.js"></script>
    <script src="xiaoxue.js"></script>
    <script>
        const units = { 
            1: unit1_3rd_upper, 
            2: unit2_3rd_upper, 
            3: unit3_3rd_upper, 
            4: unit1_4th_upper, 
            5: unit2_4th_upper, 
            6: unit3_4th_upper, 
            7: unit1_5th_upper, 
            8: unit2_5th_upper, 
            9: unit3_5th_upper, 
            10: unit1_6th_upper, 
            11: unit2_6th_upper, 
            12: elementarySchoolWords 
        };

        // 状态管理变量
        let currentUnit = 1;
        let currentQuestionIndex = 0; // 改用索引代替编号
        let correctAnswers = 0;
        let startTime = Date.now();
        let totalQuestions = 0;
        let timerInterval;

        // 初始化时获取总题数
        function initUnit(unitId) {
            currentUnit = unitId;
            currentQuestionIndex = 0;
            correctAnswers = 0;
            startTime = Date.now();
            totalQuestions = units[unitId].questions.length;
            loadQuestion();
            startTimer();
        }
        // 增加洗牌函数
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // 修改初始化函数
    function initUnit(unitId) {
        currentUnit = unitId;
        // 创建题目副本并打乱顺序
        const originalQuestions = units[unitId].questions;
        const shuffledQuestions = shuffleArray([...originalQuestions]);
        units[unitId].shuffledQuestions = shuffledQuestions; // 存储打乱后的题目
        
        currentQuestionIndex = 0;
        correctAnswers = 0;
        startTime = Date.now();
        totalQuestions = shuffledQuestions.length;
        loadQuestion();
        startTimer();
    }

        function loadQuestion() {
            const questions = units[currentUnit].shuffledQuestions; // 使用打乱后的题目
        const question = questions[currentQuestionIndex];
            const answerInput = document.getElementById('answer-input');
            document.getElementById('chinese-word').textContent = question.chinese;
            answerInput.value = '';
            answerInput.classList.remove('error');
            updateProgress();
            playAudio(question.audio); // 自动播放当前题目发音

            // 更新答案弹出框内容
            const answerPopupContent = document.getElementById('answer-popup-content');
            answerPopupContent.textContent = question.english;

            // 清空答案显示区域
            document.getElementById('answer-display').innerHTML = '';
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / totalQuestions) * 100;
            document.querySelector('.progress-fill').style.width = `${progress}%`;
            document.getElementById('question-count').textContent =
                `${currentQuestionIndex + 1}/${totalQuestions}`;
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = String(Math.floor(elapsed / 60)).padStart(2, '0');
                const seconds = String(elapsed % 60).padStart(2, '0');
                document.querySelector('.timer').textContent = `00:${minutes}:${seconds}`;
            }, 1000);
        }

        document.querySelector('.submit-btn').addEventListener('click', () => {
            const answerInput = document.getElementById('answer-input');
            const answer = answerInput.value.trim().toLowerCase();
            const currentQuestion = units[currentUnit].questions[currentQuestionIndex];
            const correctAnswer = currentQuestion.english.toLowerCase();

            if (answer === correctAnswer) {
                correctAnswers++;
                playAudio('audio/correct.mp3'); // 播放提示音

                if (currentQuestionIndex < totalQuestions - 1) {
                    currentQuestionIndex++;
                    loadQuestion();
                } else {
                    clearInterval(timerInterval);
                    showStats();
                }
                updateProgress();
            } else {
                answerInput.classList.add('error');
                alert('答案错误，请再试一次。');
            }
        });

        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const direction = btn.classList.contains('next-btn') ? 1 : -1;
                const newIndex = currentQuestionIndex + direction;

                if (newIndex >= 0 && newIndex < totalQuestions) {
                    currentQuestionIndex = newIndex;
                    loadQuestion();
                }
                updateProgress();
            });
        });

        document.getElementById('unit-select').addEventListener('change', (e) => {
            initUnit(parseInt(e.target.value));
        });

        document.querySelector('.audio-btn').addEventListener('click', () => {
            const currentQuestion = units[currentUnit].questions[currentQuestionIndex];
            playAudio(currentQuestion.audio);
        });

        document.querySelector('.show-answer-btn').addEventListener('click', () => {
            const answerPopup = document.getElementById('answer-popup');
            answerPopup.style.display = 'block';
            playAudio(units[currentUnit].questions[currentQuestionIndex].audio); // 播放当前题目的音频
        });

        document.querySelector('.explanation-btn').addEventListener('click', () => {
            const currentQuestion = units[currentUnit].questions[currentQuestionIndex];
            alert(currentQuestion.explanation);
        });
        
        function showStats() {
            const timeSpent = Math.floor((Date.now() - startTime) / 60000);
            const accuracy = ((correctAnswers / totalQuestions) * 100).toFixed(1);
            const examinerName = document.getElementById('name-input').value || '无';
            const unitName = units[currentUnit].name || document.getElementById('unit-select').options[document.getElementById('unit-select').selectedIndex].text;

            document.getElementById('examiner-name').textContent = examinerName;
            document.getElementById('unit-name').textContent = unitName;
            document.getElementById('total-time').textContent = `${timeSpent}分钟`;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            document.getElementById('total-score').textContent = correctAnswers;
            document.querySelector('.stats-panel').style.display = 'block';

            alert(`单元考试结束！考试人: ${examinerName}，单元: ${unitName}，正确率: ${accuracy}%，得分: ${correctAnswers}，耗时: ${timeSpent}分钟`);
        }

        function handleStatsClose() {
            const sendToWechat = document.getElementById('send-to-wechat').checked;
            if (sendToWechat) {
                const examinerName = document.getElementById('examiner-name').textContent;
                const unitName = document.getElementById('unit-name').textContent;
                const accuracy = document.getElementById('accuracy').textContent;
                const totalTime = document.getElementById('total-time').textContent;
                const totalScore = document.getElementById('total-score').textContent;

                const message = `考试人: ${examinerName}，单元: ${unitName}，正确率: ${accuracy}，得分: ${totalScore}，耗时: ${totalTime}`;
                // 这里需要替换为实际的微信机器人推送接口
                // 例如使用 fetch 发送 POST 请求到微信机器人接口
                // fetch('your-wechat-bot-api-url', {
                //     method: 'POST',
                //     headers: {
                //         'Content-Type': 'application/json'
                //     },
                //     body: JSON.stringify({ message })
                // })
                // .then(response => response.json())
                // .then(data => console.log(data))
                // .catch(error => console.error('Error sending message to WeChat bot:', error));
                console.log('模拟发送到微信机器人的消息:', message);
            }
            document.querySelector('.stats-panel').style.display = 'none';
        }

        function playAudio(audioPath) {
            const audio = new Audio(audioPath);
            audio.play();
        }

        async function importQuestions() {
            const url = document.getElementById('import-url').value;
            if (!url) {
                alert('请输入有效的题库URL');
                return;
            }
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`请求失败: ${response.status}`);
                }
                const newUnit = await response.json();
                const newUnitId = Object.keys(units).length + 1;
                units[newUnitId] = newUnit;
                const option = document.createElement('option');
                option.value = newUnitId;
                option.textContent = newUnit.name || `导入单元${newUnitId}`;
                document.getElementById('unit-select').appendChild(option);
                alert('题库导入成功！');
            } catch (error) {
                console.error('导入题库时出错:', error);
                alert('导入题库失败，请检查URL或网络连接。');
            }
        }

        function toggleNightMode() {
            document.body.classList.toggle('night-mode');
        }

        // 实时判断输入字母是否正确
        const answerInput = document.getElementById('answer-input');
        const answerDisplay = document.getElementById('answer-display');
        answerInput.addEventListener('input', () => {
            const inputValue = answerInput.value;
            const currentQuestion = units[currentUnit].questions[currentQuestionIndex];
            const correctAnswer = currentQuestion.english.toLowerCase();
            let displayText = '';
            for (let i = 0; i < inputValue.length; i++) {
                if (inputValue[i].toLowerCase() === correctAnswer[i]) {
                    displayText += inputValue[i];
                } else {
                    displayText += `<span class="wrong-letter">${inputValue[i]}</span>`;
                }
            }
            answerDisplay.innerHTML = displayText;
        });

        // 初始化加载
        initUnit(1);
    </script>
</body>

</html>
    
    
    <script>
    // 在原有代码基础上增加以下修改

    // 增加洗牌函数
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // 修改初始化函数
    function initUnit(unitId) {
        currentUnit = unitId;
        // 创建题目副本并打乱顺序
        const originalQuestions = units[unitId].questions;
        const shuffledQuestions = shuffleArray([...originalQuestions]);
        units[unitId].shuffledQuestions = shuffledQuestions; // 存储打乱后的题目
        
        currentQuestionIndex = 0;
        correctAnswers = 0;
        startTime = Date.now();
        totalQuestions = shuffledQuestions.length;
        loadQuestion();
        startTimer();
    }

    // 修改加载题目函数
    function loadQuestion() {
        const questions = units[currentUnit].shuffledQuestions; // 使用打乱后的题目
        const question = questions[currentQuestionIndex];
        // 剩余原有代码保持不变...
    }

    // 修改统计显示中的单元名称获取方式
    function showStats() {
        // 修改这行代码
        const unitName = units[currentUnit].name || document.getElementById('unit-select').options[document.getElementById('unit-select').selectedIndex].text;
        // 剩余原有代码保持不变...
    }

    // 在单元数据中添加name属性（需要补充到各单元JS文件中）
    // 例如在unit1_3rd_upper.js中：
    // const unit1_3rd_upper = {
    //     name: "三年级上册第1单元",
    //     questions: [...]
    // };
</script>